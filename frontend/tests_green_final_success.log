
> vitalinuage-frontend@0.0.0 test
> jest src/context/DoctorContext.test.tsx src/components/Search.test.tsx

PASS src/context/DoctorContext.test.tsx
FAIL src/components/Search.test.tsx
  ÔùÅ Console

    console.error
      Warning: An update to SearchPage inside a test was not wrapped in act(...).
      
      When testing, code that causes React state updates should be wrapped into act(...):
      
      act(() => {
        /* fire events that update state */
      });
      /* assert on the output */
      
      This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
          at SearchPage (C:\Users\pablo\Documents\Vitalinuage\frontend\src\pages\Search.tsx:20:34)
          at DoctorProvider (C:\Users\pablo\Documents\Vitalinuage\frontend\src\context\DoctorContext.tsx:49:34)

      37 |
      38 |     const onSubmit = async (data: PatientSearchQuery) => {
    > 39 |         setSearchError(null);
         |         ^
      40 |         setResults(null);
      41 |         setHasSearched(false);
      42 |         setIsLoading(false);

      at printWarning (node_modules/react-dom/cjs/react-dom.development.js:86:30)
      at error (node_modules/react-dom/cjs/react-dom.development.js:60:7)
      at warnIfUpdatesNotWrappedWithActDEV (node_modules/react-dom/cjs/react-dom.development.js:27628:9)
      at scheduleUpdateOnFiber (node_modules/react-dom/cjs/react-dom.development.js:25547:5)
      at dispatchSetState (node_modules/react-dom/cjs/react-dom.development.js:16708:7)
      at onSubmit (src/pages/Search.tsx:39:9)
      at errors (node_modules/react-hook-form/src/logic/createFormControl.ts:1281:24)

    console.error
      Warning: An update to SearchPage inside a test was not wrapped in act(...).
      
      When testing, code that causes React state updates should be wrapped into act(...):
      
      act(() => {
        /* fire events that update state */
      });
      /* assert on the output */
      
      This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
          at SearchPage (C:\Users\pablo\Documents\Vitalinuage\frontend\src\pages\Search.tsx:20:34)
          at DoctorProvider (C:\Users\pablo\Documents\Vitalinuage\frontend\src\context\DoctorContext.tsx:49:34)

      38 |     const onSubmit = async (data: PatientSearchQuery) => {
      39 |         setSearchError(null);
    > 40 |         setResults(null);
         |         ^
      41 |         setHasSearched(false);
      42 |         setIsLoading(false);
      43 |

      at printWarning (node_modules/react-dom/cjs/react-dom.development.js:86:30)
      at error (node_modules/react-dom/cjs/react-dom.development.js:60:7)
      at warnIfUpdatesNotWrappedWithActDEV (node_modules/react-dom/cjs/react-dom.development.js:27628:9)
      at scheduleUpdateOnFiber (node_modules/react-dom/cjs/react-dom.development.js:25547:5)
      at dispatchSetState (node_modules/react-dom/cjs/react-dom.development.js:16708:7)
      at onSubmit (src/pages/Search.tsx:40:9)
      at errors (node_modules/react-hook-form/src/logic/createFormControl.ts:1281:24)

    console.error
      Warning: An update to SearchPage inside a test was not wrapped in act(...).
      
      When testing, code that causes React state updates should be wrapped into act(...):
      
      act(() => {
        /* fire events that update state */
      });
      /* assert on the output */
      
      This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
          at SearchPage (C:\Users\pablo\Documents\Vitalinuage\frontend\src\pages\Search.tsx:20:34)
          at DoctorProvider (C:\Users\pablo\Documents\Vitalinuage\frontend\src\context\DoctorContext.tsx:49:34)

      39 |         setSearchError(null);
      40 |         setResults(null);
    > 41 |         setHasSearched(false);
         |         ^
      42 |         setIsLoading(false);
      43 |
      44 |         // Feature Flag Check - Requirement 1

      at printWarning (node_modules/react-dom/cjs/react-dom.development.js:86:30)
      at error (node_modules/react-dom/cjs/react-dom.development.js:60:7)
      at warnIfUpdatesNotWrappedWithActDEV (node_modules/react-dom/cjs/react-dom.development.js:27628:9)
      at scheduleUpdateOnFiber (node_modules/react-dom/cjs/react-dom.development.js:25547:5)
      at dispatchSetState (node_modules/react-dom/cjs/react-dom.development.js:16708:7)
      at onSubmit (src/pages/Search.tsx:41:9)
      at errors (node_modules/react-hook-form/src/logic/createFormControl.ts:1281:24)

    console.error
      Warning: An update to SearchPage inside a test was not wrapped in act(...).
      
      When testing, code that causes React state updates should be wrapped into act(...):
      
      act(() => {
        /* fire events that update state */
      });
      /* assert on the output */
      
      This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
          at SearchPage (C:\Users\pablo\Documents\Vitalinuage\frontend\src\pages\Search.tsx:20:34)
          at DoctorProvider (C:\Users\pablo\Documents\Vitalinuage\frontend\src\context\DoctorContext.tsx:49:34)

      40 |         setResults(null);
      41 |         setHasSearched(false);
    > 42 |         setIsLoading(false);
         |         ^
      43 |
      44 |         // Feature Flag Check - Requirement 1
      45 |         if (!featureFlags.identity_search_v1) {

      at printWarning (node_modules/react-dom/cjs/react-dom.development.js:86:30)
      at error (node_modules/react-dom/cjs/react-dom.development.js:60:7)
      at warnIfUpdatesNotWrappedWithActDEV (node_modules/react-dom/cjs/react-dom.development.js:27628:9)
      at scheduleUpdateOnFiber (node_modules/react-dom/cjs/react-dom.development.js:25547:5)
      at dispatchSetState (node_modules/react-dom/cjs/react-dom.development.js:16708:7)
      at onSubmit (src/pages/Search.tsx:42:9)
      at errors (node_modules/react-hook-form/src/logic/createFormControl.ts:1281:24)

  ÔùÅ Search Component Integration ÔÇ║ should call Search API if query length >= 3

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: StringContaining "/api/pacientes/search?q=Test", Anything
    Received: "http://test-api/api/pacientes/search?q=Test"

    Number of calls: 1

    Ignored nodes: comments, script, style
    <html>
      <head />
      <body>
        <div>
          <div
            class="min-h-screen bg-white flex flex-col items-center pt-[20vh] font-sans px-4"
          >
            <h1
              class="text-4xl font-light text-slate-800 mb-8 tracking-tight"
            >
              Buenas tardes
              , 
              <span
                class="font-semibold text-[#1e3a8a]"
              >
                Dr. Vitali
              </span>
            </h1>
            <div
              class="w-full max-w-2xl relative"
            >
              <form
                class="relative group"
              >
                <div
                  class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none"
                >
                  <svg
                    class="lucide lucide-search h-5 w-5 text-gray-400 group-focus-within:text-[#1e3a8a] transition-colors"
                    fill="none"
                    height="24"
                    stroke="currentColor"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    viewBox="0 0 24 24"
                    width="24"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <circle
                      cx="11"
                      cy="11"
                      r="8"
                    />
                    <path
                      d="m21 21-4.3-4.3"
                    />
                  </svg>
                </div>
                <input
                  autocomplete="off"
                  class="w-full pl-12 pr-4 py-3.5 rounded-full border border-gray-200 shadow-sm focus:shadow-md focus:border-transparent focus:ring-2 focus:ring-blue-100 outline-none transition-all text-gray-800 text-lg"
                  name="query"
                  placeholder="Buscar paciente por nombre o DNI..."
                  type="text"
                />
                <button
                  class="hidden"
                  type="submit"
                />
              </form>
            </div>
            <div
              class="w-full max-w-2xl mt-8"
            >
              <div
                class="text-center mt-8"
              >
                <p
                  class="text-gray-600 mb-4"
                >
                  No se encontr├│ a 
                  <span
                    class="font-semibold"
                  >
                    "
                    Test
                    "
                  </span>
                  .
                </p>
                <button
                  class="bg-[#1e3a8a] hover:bg-blue-900 text-white font-medium py-2 px-6 rounded-md transition-colors shadow-sm"
                >
                  + Registrar a 
                  Test
                   como nuevo paciente
                </button>
              </div>
            </div>
          </div>
        </div>
      </body>
    </html>

      64 |         // Green Phase: Logic Implemented
      65 |         await waitFor(() => {
    > 66 |             expect(global.fetch).toHaveBeenCalledWith(
         |                                  ^
      67 |                 expect.stringContaining('/api/pacientes/search?q=Test'),
      68 |                 expect.anything()
      69 |             );

      at src/components/Search.test.tsx:66:34
      at runWithExpensiveErrorDiagnosticsDisabled (node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:124:77)
      at checkRealTimersCallback (node_modules/@testing-library/dom/dist/wait-for.js:118:16)
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:579:19)

Test Suites: 1 failed, 1 passed, 2 total
Tests:       1 failed, 4 passed, 5 total
Snapshots:   0 total
Time:        5.457 s
Ran all test suites matching src/context/DoctorContext.test.tsx|src/components/Search.test.tsx.
